<!DOCTYPE html>
<html>
<head>
    <title>TariffIQ - Smart Tariff Optimization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 font-sans text-gray-800">

<!-- Hero Section -->
<header class="text-center p-16 bg-gradient-to-b from-[#0071CE] to-[#005BA3] text-white rounded">
    <h1 class="text-5xl font-bold">TariffIQ</h1>
    <p class="text-xl mt-3">Smarter Tariff Decisions, Stronger Supply Chains</p>
    <a href="#main-menu" class="inline-block mt-6 bg-white text-[#0071CE] rounded px-6 py-3 font-bold hover:scale-105">Get Started</a>
</header>

<!-- Introduction Section -->
<section class="max-w-4xl mx-auto text-center mt-12 p-4">
    <h2 class="text-3xl font-bold text-[#0071CE]">Why Use TariffIQ?</h2>
    <p class="text-gray-600 mt-3">TariffIQ empowers Walmart with AI-driven pricing, supplier optimization, and cost comparisons. Stay resilient in an evolving global trade environment with actionable insights and quick decisions.</p>
</section>

<!-- Features Grid -->
<section class="max-w-4xl mx-auto mt-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 p-4">
    <div class="bg-white rounded-lg shadow p-4 text-center">
        <span class="text-3xl">🌍</span>
        <h3 class="font-bold mt-2">Real-Time Monitoring</h3>
        <p class="text-gray-600">Instant alerts and impact simulations for global tariff changes.</p>
    </div>
    <div class="bg-white rounded-lg shadow p-4 text-center">
        <span class="text-3xl">📊</span>
        <h3 class="font-bold mt-2">Cost Comparison</h3>
        <p class="text-gray-600">Visualize pricing across suppliers and countries with a click!</p>
    </div>
    <div class="bg-white rounded-lg shadow p-4 text-center">
        <span class="text-3xl">⚡️</span>
        <h3 class="font-bold mt-2">Rapid Decision Making</h3>
        <p class="text-gray-600">Make agile procurement and pricing decisions quickly and confidently.</p>
    </div>
</section>

<!-- Call-To-Action Area -->
<section class="bg-[#EAF4FF] rounded p-6 mt-12 text-center max-w-4xl mx-auto">
    <h2 class="text-3xl font-bold text-[#0071CE]">Adapt. Save. Thrive. 🌱</h2>
    <p class="text-gray-600 mt-2">TariffIQ is your AI assistant for making intelligent supply chain decisions every day, no matter the market changes.</p>
</section>

<!-- Main Menu -->
<div id="main-menu" class="max-w-4xl mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 p-4 mt-12">
    <div class="bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-lg" data-target="suppliers">
        <h2 class="text-xl font-bold text-[#0071CE]">📋 Suppliers List</h2>
        <p class="text-gray-600">View available suppliers</p>
    </div>
    <div class="bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-lg" data-target="tariff">
        <h2 class="text-xl font-bold text-[#0071CE]">💵 Tariff Impact</h2>
        <p class="text-gray-600">Calculate cost after tariff</p>
    </div>
    <div class="bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-lg" data-target="add-supplier">
        <h2 class="text-xl font-bold text-[#0071CE]">➕ Add New Supplier</h2>
        <p class="text-gray-600">Add suppliers to the database</p>
    </div>
    <div class="bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-lg" data-target="comparison">
        <h2 class="text-xl font-bold text-[#0071CE]">📊 Cost Comparison</h2>
        <p class="text-gray-600">Compare supplier pricing</p>
    </div>
    <div class="bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-lg" data-target="top-suppliers">
        <h2 class="text-xl font-bold text-[#0071CE]">🏅 Top Suppliers</h2>
        <p class="text-gray-600">View top suppliers for a selected product</p>
    </div>
    <div class="bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-lg" data-target="cost-optimization">
        <h2 class="text-xl font-bold text-[#0071CE]">💰 Cost Optimization</h2>
        <p class="text-gray-600">Get best cost for a selected product</p>
    </div>
</div>

<!-- Back Button -->
<div id="back-button-container" class="max-w-4xl mx-auto p-4 hidden">
    <button id="back-button" class="bg-[#0071CE] text-white rounded p-2 hover:bg-[#005BA3]">← Back to Main Menu</button>
</div>

<!-- Sections -->
<div class="max-w-4xl mx-auto space-y-8 p-4 hidden" id="sections">
    <!-- Suppliers List Section -->
    <div id="section-suppliers" class="bg-white rounded-lg shadow p-6 hidden">
        <h2 class="text-2xl font-semibold text-gray-700">Suppliers List</h2>
        <div class="overflow-x-auto mt-3">
            <table class="min-w-full border rounded">
                <thead class="bg-[#F9FAFB] text-gray-600">
                    <tr>
                        <th class="text-left p-3">Name</th>
                        <th class="text-left p-3">Country</th>
                        <th class="text-left p-3">Product</th>
                        <th class="text-left p-3">Cost ($)</th>
                    </tr>
                </thead>
                <tbody id="suppliers-table" class="bg-white"></tbody>
            </table>
        </div>
    </div>

    <!-- Tariff Impact Section -->
    <div id="section-tariff" class="bg-white rounded-lg shadow p-6 hidden">
        <h2 class="text-2xl font-semibold text-gray-700">Calculate Tariff Impact</h2>
        <form id="tariff-form" class="mt-3 space-y-3">
            <div>
                <label class="font-medium">Product:</label>
                <select id="product" class="border rounded p-2 w-full" required></select>
            </div>
            <div>
                <label class="font-medium">Country:</label>
                <select id="country" class="border rounded p-2 w-full" required></select>
            </div>
            <div>
                <label class="font-medium">Tariff Percentage (%):</label>
                <input id="tariff" type="number" class="border rounded p-2 w-full" required />
            </div>
            <button class="bg-[#0071CE] hover:bg-[#005BA3] text-white rounded p-2 mt-3 w-full" type="submit">Calculate</button>
        </form>
        <h3 class="text-lg font-bold mt-4">Result:</h3>
        <p id="impact-result" class="text-gray-700 mt-2"></p>
    </div>

    <!-- Add New Supplier Section -->
    <div id="section-add-supplier" class="bg-white rounded-lg shadow p-6 hidden">
        <h2 class="text-2xl font-semibold text-gray-700">Add New Supplier</h2>
        <form id="add-supplier-form" class="mt-3 space-y-3">
            <div><label class="font-medium">Name:</label><input id="new-supplier-name" class="border rounded p-2 w-full" required /></div>
            <div><label class="font-medium">Country:</label><input id="new-supplier-country" class="border rounded p-2 w-full" required /></div>
            <div><label class="font-medium">Product:</label><input id="new-supplier-product" class="border rounded p-2 w-full" required /></div>
            <div><label class="font-medium">Cost ($):</label><input id="new-supplier-cost" type="number" class="border rounded p-2 w-full" required /></div>
            <button class="bg-[#0071CE] hover:bg-[#005BA3] text-white rounded p-2 mt-3 w-full" type="submit">Add Supplier</button>
        </form>
        <p id="add-supplier-result" class="text-gray-700 mt-2"></p>
    </div>

    <!-- Cost Comparison Section -->
    <div id="section-comparison" class="bg-white rounded-lg shadow p-6 hidden">
        <h2 class="text-2xl font-semibold text-gray-700">Cost Comparison</h2>
        <div class="mt-3">
            <label for="product-select" class="font-medium">Choose Product:</label>
            <select id="product-select" class="border rounded p-2 w-full mt-1"></select>
        </div>
        <canvas id="comparisonChart" class="mt-4" height="150"></canvas>
    </div>

    <!-- Top Suppliers Section -->
    <div id="section-top-suppliers" class="bg-white rounded-lg shadow p-6 hidden">
        <h2 class="text-2xl font-semibold text-gray-700">Top Suppliers</h2>
        <div class="mt-3">
            <label for="top-supplier-product" class="font-medium">Choose Product:</label>
            <select id="top-supplier-product" class="border rounded p-2 w-full mt-1"></select>
            <button id="fetch-top-suppliers" class="bg-[#0071CE] hover:bg-[#005BA3] text-white rounded p-2 mt-3 w-full">Get Top Suppliers</button>
        </div>
        <table class="min-w-full border rounded mt-3">
            <thead class="bg-[#F9FAFB] text-gray-600">
                <tr><th class="text-left p-3">Name</th><th class="text-left p-3">Country</th><th class="text-left p-3">Cost ($)</th></tr>
            </thead>
            <tbody id="top-suppliers-table"></tbody>
        </table>
    </div>

    <!-- Cost Optimization Section -->
    <div id="section-cost-optimization" class="bg-white rounded-lg shadow p-6 hidden">
        <h2 class="text-2xl font-semibold text-gray-700">Cost Optimization</h2>
        <div class="mt-3">
            <label for="cost-optimization-product" class="font-medium">Choose Product:</label>
            <select id="cost-optimization-product" class="border rounded p-2 w-full mt-1"></select>
            <button id="fetch-cost-optimization" class="bg-[#0071CE] hover:bg-[#005BA3] text-white rounded p-2 mt-3 w-full">Get Best Cost</button>
        </div>
        <div id="cost-optimization-result" class="mt-3 text-gray-700 font-bold"></div>
    </div>
</div>

<!-- Scripts -->
<script>
let suppliersData = [];

// Load suppliers
async function loadSuppliers() {
    const resp = await fetch('/suppliers');
    suppliersData = await resp.json();
    const tableBody = document.querySelector('#suppliers-table');
    tableBody.innerHTML = suppliersData.map(s => `
        <tr class="border-t hover:bg-[#EAF4FF]">
            <td class="p-3">${s.name}</td>
            <td class="p-3">${s.country}</td>
            <td class="p-3">${s.product}</td>
            <td class="p-3">${s.cost}</td>
        </tr>
    `).join('');

    const uniqueProducts = [...new Set(suppliersData.map(s => s.product.trim()))];
    const uniqueCountries = [...new Set(suppliersData.map(s => s.country.trim()))];
    const productDropdown = document.getElementById('product');
    const countryDropdown = document.getElementById('country');
    const chartProductDropdown = document.getElementById('product-select');
    const topSuppliersProduct = document.getElementById('top-supplier-product');
    const costOptimizationProduct = document.getElementById('cost-optimization-product');

    [productDropdown, chartProductDropdown, topSuppliersProduct, costOptimizationProduct].forEach(dropdown => {
        if (!dropdown) return;
        dropdown.innerHTML = '';
        uniqueProducts.forEach(p => {
            const option = document.createElement('option');
            option.value = p;
            option.text = p;
            dropdown.appendChild(option);
        });
    });
    countryDropdown.innerHTML = '';
    uniqueCountries.forEach(c => {
        const option = document.createElement('option');
        option.value = c;
        option.text = c;
        countryDropdown.appendChild(option);
    });
}

async function loadChart() {
    const product = document.getElementById('product-select').value.trim();
    const filtered = suppliersData.filter(s => s.product.trim().toLowerCase() === product.toLowerCase());

    if (!filtered.length) {
        console.warn("No suppliers found for this product:", product);
        return;
    }

    const labels = filtered.map(s => `${s.name} (${s.country})`);
    const data = filtered.map(s => s.cost);
    const ctx = document.getElementById('comparisonChart').getContext('2d');

    if (window.comparisonChart && window.comparisonChart instanceof Chart) {
        window.comparisonChart.destroy();
    }

    window.comparisonChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels,
            datasets: [{ label: 'Cost', data, backgroundColor: '#0071CE' }]
        },
        options: {
            scales: {
                y: { title: { display: true, text: 'Cost ($)' } }
            }
        }
    });
}

// Event Listeners
document.getElementById('product-select').addEventListener('change', loadChart);

// Tariff Form
const tariffForm = document.getElementById('tariff-form');
tariffForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const product = document.getElementById('product').value.trim();
    const country = document.getElementById('country').value.trim();
    const tariff = parseFloat(document.getElementById('tariff').value);
    const resp = await fetch('/impact', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({product, country, new_tariff: tariff})
    });
    const data = await resp.json();
    const resultText = data.impact
        ? `Resulting Cost after ${tariff}% tariff for ${product} (${country}): $${data.impact.toFixed(2)}`
        : 'Product/Country not found';
    document.getElementById('impact-result').innerText = resultText;
});

// Add New Supplier
const addSupplierForm = document.getElementById('add-supplier-form');
addSupplierForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const newSupplier = {
        name: document.getElementById('new-supplier-name').value.trim(),
        country: document.getElementById('new-supplier-country').value.trim(),
        product: document.getElementById('new-supplier-product').value.trim(),
        cost: parseFloat(document.getElementById('new-supplier-cost').value.trim()),
    };
    const resp = await fetch('/add_supplier', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(newSupplier),
    });
    const result = await resp.json();
    document.getElementById('add-supplier-result').innerText = result.status === 'success'
        ? '✅ New supplier added successfully!'
        : '❌ Failed to add supplier.';
    loadSuppliers();
});

// Top Suppliers
document.getElementById('fetch-top-suppliers').addEventListener('click', async () => {
    const product = document.getElementById('top-supplier-product').value.trim();
    const resp = await fetch(`/top_suppliers?product=${product}&n=3`);
    const data = await resp.json();
    const tableBody = document.getElementById('top-suppliers-table');
    tableBody.innerHTML = '';
    data.forEach(s => {
        tableBody.innerHTML += `
            <tr class="border-t hover:bg-[#EAF4FF]">
                <td class="p-3">${s.name}</td>
                <td class="p-3">${s.country}</td>
                <td class="p-3">${s.cost}</td>
            </tr>`;
    });
});

// Cost Optimization
document.getElementById('fetch-cost-optimization').addEventListener('click', async () => {
    const product = document.getElementById('cost-optimization-product').value.trim();
    const resp = await fetch(`/cost_optimization?product=${product}`);
    const data = await resp.json();
    const resultDiv = document.getElementById('cost-optimization-result');
    if (data.error) {
        resultDiv.innerText = data.error;
    } else {
        resultDiv.innerText = `Best Cost: $${data.cost} from ${data.supplier} (${data.country})`;
    }
});

// Menu Navigation
const menuItems = document.querySelectorAll('#main-menu [data-target]');
menuItems.forEach(item => {
    item.addEventListener('click', (e) => {
        const target = e.currentTarget.getAttribute('data-target');
        document.getElementById('main-menu').classList.add('hidden');
        document.getElementById('sections').classList.remove('hidden');
        document.getElementById('back-button-container').classList.remove('hidden');
        [...document.querySelectorAll('#sections > div')].forEach(sec => {
            sec.classList.add('hidden');
        });
        document.getElementById(`section-${target}`).classList.remove('hidden');
    });
});

// Back Button
document.getElementById('back-button').addEventListener('click', () => {
    document.getElementById('main-menu').classList.remove('hidden');
    document.getElementById('sections').classList.add('hidden');
    document.getElementById('back-button-container').classList.add('hidden');
});

// Init
loadSuppliers();
</script>

</body>
</html>
